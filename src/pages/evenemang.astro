---
import Layout from '../components/Layout.astro';
import { siteConfig, getImageSrcSet, imageSizes } from '../config.ts';
import { servicesContent } from '../content/services';
import { eventsContent } from '../content/events';
import * as LucideIcons from '@lucide/astro';
import { marked } from 'marked';

const service = servicesContent[2];
const bodyHtml = await marked(service.body);

const eventsWithHtml = await Promise.all(
  eventsContent.map(async (event) => ({
    ...event,
    bodyHtml: await marked(event.body),
  }))
);
---

<Layout title={`${service.title} - ${siteConfig.site.title}`} description={service.description}>
  <main class="min-h-screen">
    <div class="mx-auto max-w-7xl px-4 py-20 sm:px-6 lg:px-8">
      <div class="mt-12 mb-12">
        <h1 class="text-5xl font-bold mb-8 text-center">{service.title}</h1>
        <div class="md:columns-2 gap-8 text-lg text-gray-700 leading-relaxed [&>p]:mb-4" set:html={bodyHtml}></div>
      </div>

      <section class="mt-16">
        <div class="flex flex-col gap-8">
        {eventsWithHtml.map((event, index) => {
          const IconComponent = LucideIcons[event.icon];
          return (
          <article class="scroll-fade-up w-full rounded-2xl bg-[var(--color-bg-card)] overflow-hidden shadow-sm stagger-${(index % 9) + 1}" key={event.title}>
            <div class="grid gap-0 md:grid-cols-3">
              <div
                class={`flex flex-col justify-center p-8 md:p-10 md:col-span-2 ${
                  index % 2 === 0 ? 'order-1' : 'order-2'
                }`}
              >
                <div class="flex items-center gap-4 mb-4">
                  <div class="feature-icon bg-[var(--color-orange)] flex h-14 w-14 items-center justify-center rounded-lg text-white flex-shrink-0">
                    <IconComponent class="h-7 w-7" />
                  </div>
                  <h2 class="text-3xl font-semibold card-title">{event.title}</h2>
                </div>
                <div class="text-gray-700 leading-relaxed [&>p]:mb-4" set:html={event.bodyHtml}></div>
              </div>
              <div class={`${index % 2 === 0 ? 'order-2' : 'order-1'} h-72 md:h-full`}>
                <img
                  srcset={getImageSrcSet(event.image)}
                  sizes={imageSizes.eventImage}
                  src={event.image.desktop}
                  alt={event.alt}
                  class="h-full w-full object-cover"
                  loading="lazy"
                />
              </div>
            </div>
          </article>
          );
        })}
        </div>
      </section>
    </div>
  </main>
</Layout>
