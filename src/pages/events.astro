---
import Layout from '../components/Layout.astro';
import { Image } from 'astro:assets';
import { siteConfig, getImageSrcSet, imageSizes } from '../config.ts';
import { servicesContent } from '../content/services';
import { eventsContent } from '../content/events';
import * as LucideIcons from '@lucide/astro';
import { marked } from 'marked';
import { Calendar } from '@lucide/astro';

const service = servicesContent[2];
const bodyHtml = await marked(service.body);

const eventsWithHtml = await Promise.all(
  eventsContent.map(async (event) => ({
    ...event,
    bodyHtml: await marked(event.body),
  }))
);
---

<Layout title={`${service.title} - ${siteConfig.site.title}`} description={service.description}>
  <main class="min-h-screen">
    <div class="mx-auto max-w-7xl px-4 pt-20 sm:px-6 lg:px-8">
      <div class="mt-12 mb-12">
        <h1 class="text-5xl font-bold mb-8 text-center">{service.title}</h1>
        <div class="md:columns-2 gap-8 text-lg text-gray-700 leading-relaxed [&>p]:mb-4" set:html={bodyHtml}></div>
      </div>
    </div>

    <section class="bg-[var(--color-bg-main-section)] px-4 py-16 sm:px-6 lg:px-8">
      <div class="mx-auto max-w-7xl">
        <div class="text-center">
          <div class="flex items-center justify-center gap-3 mb-3">
            <div class="feature-icon bg-[var(--color-orange)] flex h-14 w-14 items-center justify-center rounded-lg text-white">
              <Calendar class="h-7 w-7" />
            </div>
          </div>
          <p class="text-xl font-semibold text-gray-800">
            Se våra aktuella events <a href="https://events.livingit.se/" target="_blank" rel="noopener noreferrer" class="text-gray-800 hover:text-gray-700 underline">här</a>!
          </p>
        </div>
      </div>
    </section>

    <div class="mx-auto max-w-7xl px-4 pb-20 sm:px-6 lg:px-8">
      <section class="mt-16">
        <div class="flex flex-col gap-8">
        {eventsWithHtml.map((event, index) => {
          const IconComponent = LucideIcons[event.icon];
          return (
          <article class="scroll-fade-up w-full rounded-2xl bg-[var(--color-bg-card)] overflow-hidden shadow-sm stagger-${(index % 9) + 1} hover:shadow-lg transition-shadow" key={event.title}>
            <div class="grid gap-0 grid-cols-1 md:grid-cols-3">
              <div
                class={`flex flex-col justify-center p-8 md:p-10 md:col-span-2 ${
                  index % 2 === 0 ? 'order-1' : 'order-2'
                }`}
              >
                <div class="flex items-center gap-4 mb-4">
                  <div class="feature-icon bg-[var(--color-orange)] flex h-14 w-14 items-center justify-center rounded-lg text-white flex-shrink-0">
                    <IconComponent class="h-7 w-7" />
                  </div>
                  <h2 class="text-3xl font-semibold card-title">{event.title}</h2>
                </div>
                <div class="text-gray-700 leading-relaxed [&>p]:mb-4" set:html={event.bodyHtml}></div>
              </div>
              <div class={`${index % 2 === 0 ? 'order-2' : 'order-1'} h-72 md:h-full w-full p-10`}>
                <div class="carousel-frame" data-carousel data-interval="4500">
                  {event.images.map((images, imgIndex) => (
                    <Image
                      srcset={getImageSrcSet(images)}
                      sizes={imageSizes.eventImage}
                      src={images.desktop}
                      alt={`${event.alt} ${imgIndex + 1}`}
                      width={800}
                      height={800}
                      class={`carousel-image ${imgIndex === 0 ? 'is-active' : ''}`}
                      loading={index === 0 && imgIndex === 0 ? 'eager' : 'lazy'}
                      data-carousel-image
                    />
                  ))}
                </div>
              </div>
            </div>
          </article>
          );
        })}
        </div>
      </section>
    </div>
  </main>
</Layout>

<script>
  document.querySelectorAll('[data-carousel]').forEach((carousel) => {
    const slides = carousel.querySelectorAll('[data-carousel-image]');
    if (slides.length < 2) return;

    let index = 0;
    const interval = Number(carousel.getAttribute('data-interval')) || 4500;

    setInterval(() => {
      slides[index].classList.remove('is-active');
      index = (index + 1) % slides.length;
      slides[index].classList.add('is-active');
    }, interval);
  });
</script>
